<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using Pyposterous &mdash; Pyposterous v0.2.1 documentation</title>
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.2.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Pyposterous v0.2.1 documentation" href="index.html" />
    <link rel="next" title="API Reference" href="api_reference.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="api_reference.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Pyposterous v0.2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-pyposterous">
<span id="tutorial"></span><h1>Using Pyposterous<a class="headerlink" href="#using-pyposterous" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Thanks for checking out Pyposterous. If you have any issues using the library, please be sure to post something on the <a class="reference external" href="http://github.com/thomasw/pyposterous/issues">project&#8217;s issues page</a>.</p>
<p>Start by importing Pyposterous:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyposterous</span>
</pre></div>
</div>
</div>
<div class="section" id="unauthenticated-methods">
<h2>Unauthenticated Methods<a class="headerlink" href="#unauthenticated-methods" title="Permalink to this headline">¶</a></h2>
<p>Many of Posterous&#8217;s API calls do not require authentication. If you&#8217;re only using these methods, you can just use the api object that&#8217;s automatically instantiated when you import the library:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">api</span> <span class="o">=</span> <span class="n">pyposterous</span><span class="o">.</span><span class="n">api</span>
</pre></div>
</div>
<p>Here&#8217;s a list of methods that you can use without authenticating:</p>
<ol class="arabic simple">
<li><a class="reference external" href="api_reference.html#read-posts-method"><em>read_posts</em></a></li>
<li><a class="reference external" href="api_reference.html#get-tags-method"><em>get_tags</em></a></li>
<li><a class="reference external" href="api_reference.html#get-post-method"><em>get_post</em></a></li>
<li><a class="reference external" href="api_reference.html#upload-method"><em>upload</em></a> (requires Twitter credentials)</li>
<li><a class="reference external" href="api_reference.html#upload-and-post-method"><em>upload_and_post</em></a> (requires Twitter credentials)</li>
</ol>
<p>As you might expect, read_posts won&#8217;t return private posts and get_tags won&#8217;t return tags of private posts/sites if you&#8217;re not authenticated.</p>
<p>Here&#8217;s how to get all public posts tagged with &#8216;api&#8217; from a site:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">api</span><span class="o">.</span><span class="n">read_posts</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="s">&#39;pyposttest&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s">&#39;api&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>get_tags works in a similar way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">api</span><span class="o">.</span><span class="n">get_tags</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="s">&#39;pyposttest&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>get_post is a part of the <a class="reference external" href="http://posterous.com/api/postly">post.ly api</a> and it&#8217;s a little differently. Instead of accepting a numeric post id (e.g. post.id), it accepts a post.ly short code (which will always be a string).</p>
<p>The shortcode is the combination of letters and numbers following the last slash in a post.ly URL. For example, given <a class="reference external" href="http://post.ly/d8W2">http://post.ly/d8W2</a> as the post.ly url, here&#8217;s the appropriate code to get the post that the URL points at:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">api</span><span class="o">.</span><span class="n">get_post</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">&#39;d8S6&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you had the URL stored in a variable, the following would also work:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://post.ly/d8W2&#39;</span>
<span class="n">api</span><span class="o">.</span><span class="n">get_post</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;http://post.ly/&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="authenticated-methods">
<h2>Authenticated Methods<a class="headerlink" href="#authenticated-methods" title="Permalink to this headline">¶</a></h2>
<p>Most of the fun methods require authentication. For that, a new API instance must be instantiated with a username and password. Here&#8217;s how:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">api</span> <span class="o">=</span> <span class="n">pyposterous</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;username&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;password&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the difference in case from our earlier code. pyposterous.API is the class and pyposterous.api is an unauthenticated instance of the API class.</p>
<p>With an authenticated API instance, you can then call the following without Pyposterous raising an exception:</p>
<ol class="arabic simple">
<li><a class="reference external" href="api_reference.html#get-sites-method"><em>get_sites</em></a></li>
<li><a class="reference external" href="api_reference.html#new-post-method"><em>new_post</em></a></li>
<li><a class="reference external" href="api_reference.html#update-post-method"><em>update_post</em></a></li>
<li><a class="reference external" href="api_reference.html#new-comment-method"><em>new_comment</em></a></li>
</ol>
<p>One of the most important authenticated method is get_sites. It returns a list of all the authenticated user&#8217;s sites:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sites</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">get_sites</span><span class="p">()</span>
</pre></div>
</div>
<p>This method can also be used to test the validity of credentials because it will fail if the username and password combination is invalid.</p>
<p>To post a new article to one of those sites returned by get_sites, either of the following would work:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">new_post</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Test!&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&quot;This is a test post. How cool.&quot;</span><span class="p">)</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">new_post</span><span class="p">(</span><span class="n">site_id</span><span class="o">=</span><span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Test!&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&quot;This is a test post. How cool.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Posting a comment on that article:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Easy way!</span>
<span class="n">post</span><span class="o">.</span><span class="n">new_comment</span><span class="p">(</span><span class="s">&quot;This article is ridiculous.&quot;</span><span class="p">)</span>

<span class="c"># Hard way!</span>
<span class="n">api</span><span class="o">.</span><span class="n">new_comment</span><span class="p">(</span><span class="n">post_id</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;This article is ridiculous.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Updating the posted article:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Easy way</span>
<span class="n">post</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;TEST TEST TEST TEST&quot;</span>
<span class="n">post</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">&quot;This title is so much more appropriate.&quot;</span>
<span class="n">post</span><span class="o">.</span><span class="n">update_post</span><span class="p">()</span>

<span class="c"># Hard way</span>
<span class="n">api</span><span class="o">.</span><span class="n">update_post</span><span class="p">(</span><span class="n">post_id</span><span class="o">=</span><span class="n">post</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;TEST TEST TEST TEST&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&quot;This title is so much more appropriate.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="data-returned">
<h2>Data Returned<a class="headerlink" href="#data-returned" title="Permalink to this headline">¶</a></h2>
<p>All API methods (with the exception of <a class="reference external" href="api_reference.html#upload-method"><em>upload</em></a> and <a class="reference external" href="api_reference.html#upload-and-post-method"><em>upload_and_post</em></a>) will return an object or list of objects that are instances of one of following classes:</p>
<ul class="simple">
<li><a class="reference external" href="api_reference.html#post-class"><em>Post</em></a></li>
<li><a class="reference external" href="api_reference.html#site-class"><em>Site</em></a></li>
<li><a class="reference external" href="api_reference.html#tag-class"><em>Tag</em></a></li>
<li><a class="reference external" href="api_reference.html#comment-class"><em>Comment</em></a></li>
</ul>
<p>Due to Posterous API inconsistencies, instances of the same type will not always have the same set of attributes. Read, bookmark, and re-read the <a class="reference external" href="http://posterous.com/api">Posterous API docs</a>, as they indicate the set of data that each API call will return.</p>
<p>In addition to the Post, Site, Comment, and Tag classes, there are also <a class="reference external" href="api_reference.html#image-class"><em>Image</em></a> and <a class="reference external" href="api_reference.html#media-class"><em>Media</em></a> classes. Your application will only encounter these as children of Post objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Returns a list of media instances</span>
<span class="n">post</span><span class="o">.</span><span class="n">media</span>

<span class="c"># Media objects with type=&#39;image&#39;, will have the following attributes:</span>
<span class="c"># Both of these attributes are Image instances</span>
<span class="n">post</span><span class="o">.</span><span class="n">media</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">medium</span>
<span class="n">post</span><span class="o">.</span><span class="n">media</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">thumbnail</span>

<span class="c"># You can also get Comment instances as children of posts.</span>
<span class="c"># The following Returns a list of comment instances</span>
<span class="n">post</span><span class="o">.</span><span class="n">comments</span>
</pre></div>
</div>
<p>Some of these objects have <a class="reference external" href="api_reference.html#helper-functions"><em>helper methods</em></a>. For example, Post instances have a method that makes submitting updated content super easy.</p>
<p>Read the <a class="reference external" href="api_reference.html#helper-functions"><em>documentation about helper methods</em></a>. Using these methods will make your code much cleaner.</p>
</div>
<div class="section" id="uploading-media">
<h2>Uploading Media<a class="headerlink" href="#uploading-media" title="Permalink to this headline">¶</a></h2>
<p>Attaching media to an article is really easy. Simply pass a file object or a list of file objects to the appropriate parameter (typically &#8216;media&#8217;).</p>
<p>To attach an image (&#8216;images/0001.jpg&#8217;) to a new post, try the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">test_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;images/00011.jpg&#39;</span><span class="p">)</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">new_post</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Testing single file upload&#39;</span><span class="p">,</span> <span class="n">media</span><span class="o">=</span><span class="n">test_file</span><span class="p">)</span>
<span class="n">test_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Pyposterous can also handle cases where there are multiple media assets that need to be attached to a post. Here&#8217;s an example that assumes images/ is a directory with multiple jpeg files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span><span class="p">,</span> <span class="n">path</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;images&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="s">&#39;images&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;.jpg&#39;</span> <span class="ow">in</span> <span class="n">fname</span><span class="p">]</span>

<span class="c"># Post the images and close them</span>
<span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Multi-file upload test!&#39;</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">new_post</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">media</span><span class="o">=</span><span class="n">images</span><span class="p">)</span>
<span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="twitter-methods">
<h2>Twitter Methods<a class="headerlink" href="#twitter-methods" title="Permalink to this headline">¶</a></h2>
<p>Posterous has two API calls that use Twitter credentials instead of Posterous credentials. In both cases, the functions that represent those calls require a twitter username and a twitter password as parameters.</p>
<p>Here&#8217;s an upload example (which doesn&#8217;t post a Tweet to the user&#8217;s Twitter account):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">post1</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;twitter_username&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;twitter_password&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Yay&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&quot;Body of post!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>upload_and_post works the same way, but upload_and_post will also Tweet a link to your new article using the specified twitter credentials.</p>
<p>Both methods return a dictionary that contains the following data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">post1</span><span class="p">[</span><span class="s">&#39;mediaid&#39;</span><span class="p">]</span>
<span class="n">post1</span><span class="p">[</span><span class="s">&#39;mediaurl&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>If necessary, you can retrieve a post object representing your uploaded content by using get_post:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">post1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_post</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">post2</span><span class="p">[</span><span class="s">&#39;mediaurl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;http://post.ly/&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="paginated-results-cursor-tutorial">
<h2>Paginated Results (Cursor Tutorial)<a class="headerlink" href="#paginated-results-cursor-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Results returned by read_posts are paginated with a limited number of posts returned per page. Thus, just calling read_posts with a site specified will not necessarily return all posts on that site. In fact, it would only return the first page of results.</p>
<p>To make iterating over paginated result sets easier, Pyposterous includes a Cursor class.</p>
<p>Here&#8217;s an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pyposterous</span> <span class="kn">import</span> <span class="n">Cursor</span>

<span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">Cursor</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">api</span><span class="o">.</span><span class="n">read_posts</span><span class="p">,</span> <span class="n">start_page</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;hostname&#39;</span><span class="p">:</span><span class="s">&#39;pyposttest&#39;</span><span class="p">,}):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> -- </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">post</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>This may seem a little tricky at first, but it&#8217;s really not that bad. You just need to create a cursor object, specify which method that you want it to call to retrieve posts, and then iterate as if you were looping over a list. Your cursor object will then automatically retrieve new pages as needed. Check out the <a class="reference external" href="api_reference.html#cursor-class"><em>Cursor documentation</em></a> for additional information.</p>
<p>The only API call that returns paginated data is read_posts. This means that the Cursor class can only be used with API.read_posts and Site.read_posts. If anything else is passed to the method parameter, an exception will be raised.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Using Pyposterous</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#unauthenticated-methods">Unauthenticated Methods</a></li>
<li><a class="reference external" href="#authenticated-methods">Authenticated Methods</a></li>
<li><a class="reference external" href="#data-returned">Data Returned</a></li>
<li><a class="reference external" href="#uploading-media">Uploading Media</a></li>
<li><a class="reference external" href="#twitter-methods">Twitter Methods</a></li>
<li><a class="reference external" href="#paginated-results-cursor-tutorial">Paginated Results (Cursor Tutorial)</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="installation.html"
                                  title="previous chapter">Installation</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="api_reference.html"
                                  title="next chapter">API Reference</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="sources/tutorial.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="api_reference.html" title="API Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">Pyposterous v0.2.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Thomas Welfley.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.5.
    </div>
  </body>
</html>